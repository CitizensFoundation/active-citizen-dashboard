<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="yp-ajax/yp-ajax.html">

<dom-module id="google-translate">
  <style>
    .translatedBy {
      color: #555;
      font-size: 9px;
    }

    .translatedText {
      border-top: 1px solid;
      border-color: #aaa;
      padding-top: 8px;
      margin-top: 8px;
    }
  </style>

  <template>
    <template is="dom-if" if="[[translatedText]]">
      <div class="layout vertical">
        <div class="translatedText">[[translatedText]]</div>
        <div class="translatedBy">translated by Google Translate</div>
      </div>
    </template>

    <yp-ajax id="translateApi" on-response="_translatedResponse"></yp-ajax>
    <yp-ajax id="checkLanguageApi" on-response="_languageDetected"></yp-ajax>

  </template>

  <script>

    Polymer({

      is: 'google-translate',

      properties: {
        translatedResponse: {
          type: Object,
          observer: "_translatedResponseChanged"
        },

        action: {
          type: String
        },

        apiKey: {
          type: String
        },

        textToTranslate: {
          type: String,
          observer: '_textToTranslateChanged'
        },

        languageDetected: {
          type: Object,
          observer: '_languageDetected'
        },

        sourceLanguage: {
          type: String
        },

        translatedText: {
          type: String
        }
      },

      _translatedResponse: function (event, detail) {
        var value = detail.response;
        if (value && value.data.translations && value.data.translations.length > 0) {
          this.set('translatedText', value.data.translations[0].translatedText);
        }
      },

      _textToTranslateChanged: function (value) {
        if (value) {
          this.$.checkLanguageApi.url = "https://www.googleapis.com/language/translate/v2/detect";
          this.$.checkLanguageApi.params = {
            key: this.apiKey,
            q: this.textToTranslate
          };
          this.$.checkLanguageApi.generateRequest();
        }
      },

      _languageDetected: function (event, detail) {
        var value = detail.response;
        if (value && value.data.detections[0][0].language!="en") {
          this.$.translateApi.url = "https://www.googleapis.com/language/translate/v2";
          this.$.translateApi.params = {
            key: this.apiKey,
            target: 'en',
            q: this.textToTranslate
          };
          this.$.translateApi.generateRequest();
        }
      }
    });
  </script>

</dom-module>
