<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">

<link rel="import" href="yp-ajax/yp-ajax.html">
<link rel="import" href="google-translate.html">
<link rel="import" href="ac-linkify-and-emoji.html">

<dom-module id="ac-news-item-small">

  <template>

    <style include="iron-flex iron-flex-alignment">
      :host {
        display: block;
        padding: 8px;
      }

      .dont-break-out {

        /* These are technically the same, but use both */
        overflow-wrap: break-word;
        word-wrap: break-word;

        -ms-word-break: break-all;
        /* This is the dangerous one in WebKit, as it breaks things wherever */
        word-break: break-all;
        /* Instead use this non-standard one: */
        word-break: break-word;

        /* Adds a hyphen where the word breaks, if supported (No Blink) */
        -ms-hyphens: auto;
        -moz-hyphens: auto;
        -webkit-hyphens: auto;
        hyphens: auto;

      }

      h1 {
        font-size: 22px;
        color: #212121;
      }

      paper-material {
        background-color: #FFF;
        padding: 16px;
        margin-top: 24px;
      }

      .container {

      }

      .link {
        margin-top: 16px;
        padding-bottom: 0px;
        border-color: #777;
      }

      .description {
        font-size: 16px;
      }

      .authorHeader {
        color: #aaa;
        padding-right: 8px;
      }

      .author {
        padding-left: 8px;
      }

      .ratingInfo {
        padding-top: 8px;
        color: #777;
      }

      .rateAgain {
        margin-top: 8px;
      }

      .mainText {
        background-color: #FFF;
        color: #000;
        padding: 8px;
      }

      .ratingCategoryHeader {
        font-size: 20px;
        margin-bottom: 16px;
        margin-top: 8px;
        color: #555;
      }

      .authorBox {
        padding-top: 8px;
        padding-right: 8px;
      }

      .authorName {
        padding-right: 8px;
      }
    </style>

    <div class="layout vertical">
      <div class="mainText">
        <google-translate hidden$="[[!hasTranslatedText]]" class="description" api-key="AIzaSyD6XEccr0-SvPNpgKdqaZpuxNlij-ior3c"
                          item="[[item]]"
                          item-id="[[item.id]]"
                          translated-text="{{hasTranslatedText}}"></google-translate>
        <div class="layout horizontal description" id="textWithEmoji" hidden$="[[hasTranslatedText]]"></div>
      </div>
      <div class="layout horizontal self-end">
        <iron-image preload width="50" height="50" src$="[[item.data_object.avatar]]"></iron-image>
      </div>
    </div>
  </template>

  <script>

    Polymer({

      is: 'ac-news-item-small',

      properties: {
        item: {
          type: Object,
          value: null
        },

        hasTranslatedText: {
          type: String
        }
      },

      observer: [
        '_hasTranslatedText(item, hasTranslatedText)'
      ],

      behaviors: [
        Polymer.AcLinkifyAndEmjoi
      ],

      _hasTranslatedText: function (item, hasTranslatedText) {
        console.error("TRANSLATED TEXT: "+hasTranslatedText);
        if (hasTranslatedText && hasTranslatedText!="") {
          this.$.textWithEmoji.innerHTML = this._removeBrackets(this.addLinksAndEmjois(hasTranslatedText));
        } else if (item) {
          this.$.textWithEmoji.innerHTML = this._removeBrackets(this.addLinksAndEmjois(item.description));
        }
      },

      _removeBrackets: function (text) {
        return text.replace(/\[/g, "").replace(/\]/g, "").replace(/\&#39;/g, "").replace(/\&quot;/g, "").replace(/\&amp;/g, "");
      },

      _rateAgain: function () {
        this.fire('rate-again', { itemId: this.item.id })
      }
    });

  </script>

</dom-module>
