<html><head><meta charset="UTF-8"><link rel="import" href="../dashboard-app.html"></head><body><dom-module id="google-translate">
  <style>
    .translatedBy {
      color: #aaa;
      font-size: 9px;
    }

    .translatedText {
      border-color: #fff;
    }

    a:link {
      color: #444;
    }
  </style>

  <template>
    <template is="dom-if" if="[[translatedText]]">
      <div class="layout vertical">
        <div id="translatedTextWithEmoji"></div>
        <div class="translatedBy">translated by Google Translate</div>
      </div>
    </template>
    <div class="layout horizontal center-center" hidden="">
      <yp-ajax id="translateApi" dispatch-error="" on-response="_translatedResponse"></yp-ajax>
      <yp-ajax id="checkLanguageApi" dispatch-error="" on-response="_languageDetected"></yp-ajax>
      <yp-ajax id="updateLanguage" method="PUT"></yp-ajax>
    </div>


  </template>a

  <script>Polymer({is:"google-translate",properties:{item:{type:Object,observer:"_itemChanged"},translatedResponse:{type:Object,observer:"_translatedResponseChanged"},action:{type:String},apiKey:{type:String},textToTranslate:{type:String},languageDetected:{type:Object,observer:"_languageDetected"},itemId:{type:Number},sourceLanguage:{type:String},translatedText:{type:String,notify:!0},translatedTextChanged:{type:Boolean,computed:"_translatedTextChanged(item, translatedText)"}},behaviors:[Polymer.AcLinkifyAndEmjoi],_translatedTextChanged:function(t,e){this.async(function(){t&&e&&this.$$("#translatedTextWithEmoji")?this.$$("#translatedTextWithEmoji").innerHTML=this.addLinksAndEmjois(e):this.$$("#translatedTextWithEmoji")&&(this.$$("#translatedTextWithEmoji").innerHTML="")},50)},_translatedResponse:function(t,e){var a=e.response;if(a&&a.data.translations&&a.data.translations.length>0){var s=a.data.translations[0].translatedText;this.set("translatedText",s),this.$$("#updateLanguage").url="/api/news_items/"+this.itemId+"/add_translation",this.$$("#updateLanguage").body={translated_text:s,language:this.sourceLanguage},this.$$("#updateLanguage").generateRequest()}},_removeBrackets:function(t){return t.replace(/\[/g,"").replace(/\]/g,"").replace(/\&#39;/g,"").replace(/\&quot;/g,"").replace(/\&amp;/g,"")},_abortRequest:function(t){t.lastRequest&&(console.warn("Aborting request"),t.lastRequest.abort())},_itemChanged:function(t){t?(this._abortRequest(this.$.checkLanguageApi),this._abortRequest(this.$.updateLanguage),this._abortRequest(this.$.translateApi),"en"==t.language?this.set("translatedText",null):t.translated_text?this.set("translatedText",this._removeBrackets(t.translated_text)):t.description?(this.set("textToTranslate",this._removeBrackets(t.description)),this.$$("#checkLanguageApi").url="https://www.googleapis.com/language/translate/v2/detect",this.$$("#checkLanguageApi").params={key:this.apiKey,q:this.textToTranslate},this.$$("#checkLanguageApi").generateRequest()):this.set("translatedText",null)):this.set("translatedText",null)},_languageDetected:function(t,e){var a=e.response;a&&"en"!=a.data.detections[0][0].language?(this.set("sourceLanguage",a.data.detections[0][0].language),this.$$("#translateApi").url="https://www.googleapis.com/language/translate/v2",this.$$("#translateApi").params={key:this.apiKey,target:"en",q:this.textToTranslate},this.$$("#translateApi").generateRequest()):a&&"en"==a.data.detections[0][0].language?(this.$$("#updateLanguage").url="/api/news_items/"+this.itemId+"/update_language",this.$$("#updateLanguage").body={language:"en"},this.$$("#updateLanguage").generateRequest(),this.set("translatedText",null)):this.set("translatedText",null)}});</script>

</dom-module>
</body></html>