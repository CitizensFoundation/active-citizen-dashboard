<html><head><meta charset="UTF-8"><link rel="import" href="../dashboard-app.html"></head><body><dom-module id="google-translate">
  <style>
    .translatedBy {
      color: #555;
      font-size: 9px;
    }

    .translatedText {
      border-color: #aaa;
      padding-top: 8px;
      margin-top: 8px;
    }
  </style>

  <template>
    <template is="dom-if" if="[[translatedText]]">
      <div class="layout vertical">
        <div class="translatedText">[[translatedText]]</div>
        <div class="translatedBy">translated by Google Translate</div>
      </div>
    </template>
    <div class="layout horizontal center-center">
      <yp-ajax id="translateApi" on-response="_translatedResponse"></yp-ajax>
      <yp-ajax id="checkLanguageApi" on-response="_languageDetected"></yp-ajax>
      <yp-ajax id="updateLanguage" method="PUT"></yp-ajax>
    </div>


  </template>

  <script>Polymer({is:"google-translate",properties:{translatedResponse:{type:Object,observer:"_translatedResponseChanged"},action:{type:String},apiKey:{type:String},textToTranslate:{type:String,observer:"_textToTranslateChanged"},languageDetected:{type:Object,observer:"_languageDetected"},itemId:{type:Number},sourceLanguage:{type:String},translatedText:{type:String}},_translatedResponse:function(e,t){var a=t.response;if(a&&a.data.translations&&a.data.translations.length>0){var s=a.data.translations[0].translatedText;this.set("translatedText",s),this.$$("#updateLanguage").url="/api/news_items/"+this.itemId+"/add_translation",this.$$("#updateLanguage").body={translated_text:s,language:this.sourceLanguage},this.$$("#updateLanguage").generateRequest()}},_textToTranslateChanged:function(e){e?(this.$$("#checkLanguageApi").url="https://www.googleapis.com/language/translate/v2/detect",this.$$("#checkLanguageApi").params={key:this.apiKey,q:this.textToTranslate},this.$$("#checkLanguageApi").generateRequest()):this.set("translatedText",null)},_languageDetected:function(e,t){var a=t.response;a&&"en"!=a.data.detections[0][0].language?(this.set("sourceLanguage",a.data.detections[0][0].language),this.$$("#translateApi").url="https://www.googleapis.com/language/translate/v2",this.$$("#translateApi").params={key:this.apiKey,target:"en",q:this.textToTranslate},this.$$("#translateApi").generateRequest()):this.set("translatedText",null)}});</script>

</dom-module>
</body></html>